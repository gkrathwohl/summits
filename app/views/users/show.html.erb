

<style>
.table th {
   text-align: center;   
}
.center_table {
  padding-top: 0px;
}
.content {
  padding-top: 2%;
}
#profile-content {
  padding-top: 2%;
}
#profile {
  padding-top: 3%;
}
.number-align{
  text-align: right;
}

.inactive span{
  visibility:hidden;
}

.inactive:hover span{
  visibility:visible;
}

.table th a{
  //color: #333;
  //text-decoration: none;
}

//.fixed { position: fixed; background:orange; }

</style>

<div class="container content">
  <div class="row">
    <div class="col-sm-3 fixed text-center" id="profile">

        <img src=<%=  @profile_url %>>
        <h3><%= @first_name %> <%= @last_name %></h3>
        <p><%= @city %>, <%= @state %></p>
        <p><%= @unique_summits %> summits</p>
        <% if @user.token %>
          <p id="status" class="text-center">Syncing...</p>
        <% else %>
          <%= link_to(image_tag("ConnectWithStrava.png", size: "171x31", ), "https://www.strava.com/oauth/authorize?client_id=3764&response_type=code&redirect_uri=" + Rails.application.config.domain_root + "/users/connect&approval_prompt=force") %>
        <% end %>
    </div>
    <div class="col-sm-9">
          <ul class="nav nav-tabs">
            <li role="presentation" class="active"><a href="#">Summits</a></li>
            <li role="presentation"><a href="/users/<%= @id %>/map">Map</a></li>
            <li role="presentation"><a href="/users/<%= @id %>/lists">Peak Lists</a></li>
          </ul>
          <div id="profile-content">
      <table class="table">
        <tbody>
          <tr>
            <th id="date-th" style="text-align:left"><a class="<%= (@sort_by == "date")? '' : 'inactive'%>" href="?sorted=date">Date <span class="caret"></span></a></th>
            <th id="summit-name-th" style="text-align:left"><a class="<%= (@sort_by == "summit-name")? '' : 'inactive'%>" href="?sorted=summit-name">Summit <span class="caret"></span></a></th>
            <th id="elev-th" style="text-align:right"><a class="<%= (@sort_by == "elevation")? '' : 'inactive'%>" href="?sorted=elevation">Elevation <span class="caret"></span></a></th>
            <th id="activity-name-th" style="text-align:left"><a class="<%= (@sort_by == "activity-name")? '' : 'inactive'%>" href="?sorted=activity-name">Activity <span class="caret"></span></a></th>
          </tr>
          <% @user.summit_completions.order(@sort_string).each do |summit| %>
            <tr>
              <td><%= summit.date.strftime("%b %-d") %></td>
              <!--<td><a href="/summits/<%= summit.osm_summit_id %>"><%= summit.summit %></a></td> -->
              <td><a href="/users/<%= summit.user_id %>/map?summit_id=<%= summit.id %>"><%= summit.summit %></a></td> 
              <td class="number-align"><%= summit.osm_summit_elevation ? (summit.osm_summit_elevation * 3.28084).to_i : "-" %> ft</td>              
              <td><a target="blank" href="https://strava.com/activities/<%= summit.activity_id %>"><%= summit.activity_name %></a></td>
              <!--<td class="text-center"><a href="https://www.strava.com/activities/<%= summit.activity_id %> " target='_blank'>Activity</a></td> -->
            </tr>
          <% end %>
          <% if !@user.token %>
            <tr>
              <td colspan="3">
                Connect with Strava to load activities
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
        </tbody>
      </table>
      </div>
    </div>
  </div>
</div>


<script>

    $.ajax("/users/get_status/<%= @user.id %>", {
      success: function(data) {
        console.log(data);
        if(data.activity_count == data.indexed_count){
          console.log("equal");
          $("#status").html('<p class="text-center" style="color: green" ><span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Strava sync complete (' + data.indexed_count + ' activities)</p>');
        }else{
          $("#status").html('<p class="text-center" style="color: red"><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> Syncing activities with Strava (' + data.indexed_count + ' / ' + data.activity_count + ' complete). Refresh page to see progress.</p>');
        }

      },
      error: function() {
        console.log("error");
      }
   });
</script>

<script>  
  $(document).ready(function () {
      $('#athletes-nav').addClass('active');
  });
</script>