

<style>
.table th {
   text-align: center;   
}
.center_table {
  padding-top: 30px;
}
.content {
  padding-top: 5%;
}
.number-align{
  text-align: right;
}
</style>

<div class="container content">
  <div class="row">
    <% if @user.token %>
      <p id="status" class="text-center">Loading...</p>
    <% else %>
      <%= link_to(image_tag("ConnectWithStrava.png", size: "171x31", ), "https://www.strava.com/oauth/authorize?client_id=3764&response_type=code&redirect_uri=" + ENV['DOMAIN'] + "/users/connect&approval_prompt=force") %>
    <% end %>
    <div class="column col-md-offset-3 center_table">
      <h3>Summit Completions</h3>
      <table class="table">
        <tbody>
          <tr>
            <th>Name</th>
            <th>Elevation</th>
            <th>Strava Link</th>
          </tr>
          <% @user.summit_completions.each do |summit| %>
            <tr>
              <td><%= summit.summit %></td>
              <td class="number-align"><%= summit.osm_summit_elevation ? (summit.osm_summit_elevation * 3.28084).to_i : "-" %> ft</td>
              <td class="text-center"><a href="https://www.strava.com/activities/<%= summit.activity_id %> " target='_blank'>Activity</a></td>
            </tr>
          <% end %>
          <% if !@user.token %>
            <tr>
              <td colspan="3">
                Connect with Strava to load activities
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
    $.ajax("/users/get_status/<%= @user.id %>", {
      success: function(data) {
        console.log(data);
        if(data.activity_count == data.indexed_count){
          console.log("equal");
          $("#status").html('<p class="text-center" style="color: green" ><span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Strava sync complete (' + data.indexed_count + 'activities)</p>');
        }else{
          $("#status").html('<p class="text-center" style="color: red"><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> Syncing activities with Strava (' + data.indexed_count + ' / ' + data.activity_count + ' complete). Refresh page to see progress.</p>');
        }

      },
      error: function() {
        console.log("error");
      }
   });
</script>